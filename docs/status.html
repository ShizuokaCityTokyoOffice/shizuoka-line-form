<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>登録内容確認</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>こんにちは！登録内容を確認します…</h2>
  <div id="output">読み込み中...</div>
  <button id="toForm" style="display:none;">登録内容を変更する</button>

  <script>
    async function main() {
      await liff.init({ liffId: "2007626441-bRzd722l" });

      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      const userId = profile.userId;

      // 正しいGASエンドポイントURLに修正
      const res = await fetch(`https://script.google.com/macros/s/AKfycby-Qxy5CtzfQDpc16cWk0Xloy1iExvT8EuEHSXbyVYirOC3qcWYZizVVH6IsNb2yk8F/exec?userId=${encodeURIComponent(userId)}`);
      const data = await res.json();

      const output = document.getElementById("output");
      if (data.success) {
        output.innerHTML = `
          <ul>
            <li><strong>表示名：</strong>${data.displayName}</li>
            <li><strong>性別：</strong>${data.gender}</li>
            <li><strong>生年月日：</strong>${data.birth}</li>
            <li><strong>興味分野：</strong>${data.interests}</li>
            <li><strong>静岡とのつながり：</strong>${data.relation}</li>
          </ul>`;
        document.getElementById("toForm").style.display = "block";
        document.getElementById("toForm").onclick = () => {
          location.href = "form.html";
        };
      } else {
        output.innerText = "登録情報が見つかりませんでした。新規登録をお願いします。";
        document.getElementById("toForm").style.display = "block";
      }
    }

    main();
  </script>
</body>
</html>
