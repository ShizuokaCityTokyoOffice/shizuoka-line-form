<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç™»éŒ²æƒ…å ±ã®ç¢ºèªãƒ»å¤‰æ›´ - ã„ã„ã­ã‡éšŠ</title>
  <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã‚€ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Interãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€ -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã¨Tailwindã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ */
    body {
      font-family: 'Inter', sans-serif; /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
      /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
      background: linear-gradient(to bottom right, #e0f2fe, #bfdbfe); /* æ·¡ã„é’ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 1s ease-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }

    /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ã‚«ãƒ¼ãƒ‰ã®åˆæœŸçŠ¶æ…‹ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰ */
    .animated-card {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.5s ease-out forwards;
      animation-delay: 0.3s; /* å°‘ã—é…ã‚Œã¦è¡¨ç¤º */
    }

    /* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼/ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    .action-button {
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, background-color 0.2s ease-out;
    }

    .action-button:hover {
      transform: translateY(-2px); /* å°‘ã—ä¸Šã«æµ®ãä¸ŠãŒã‚‹ */
      box-shadow: 0 6px 12px rgba(0,0,0,0.1); /* ã‚·ãƒ£ãƒ‰ã‚¦ã‚’å¼·èª¿ */
    }

    .action-button:active {
      transform: translateY(0); /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å…ƒã®ä½ç½®ã«æˆ»ã‚‹ */
      box-shadow: 0 2px 5px rgba(0,0,0,0.08); /* ã‚·ãƒ£ãƒ‰ã‚¦ã‚’å…ƒã«æˆ»ã™ */
    }
  </style>
</head>
<body class="text-gray-800">
  <div class="max-w-md w-full bg-white rounded-xl shadow-lg p-6 sm:p-8 animated-card">
    <h1 class="text-3xl font-extrabold text-blue-700 mb-6 text-center">ğŸ§¾ ç™»éŒ²æƒ…å ±ã®ç¢ºèªãƒ»å¤‰æ›´</h1>

    <!-- ç™»éŒ²æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="profile-info" class="mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
      <p class="text-center text-gray-500 mb-4" id="loading-message">
        <span class="animate-spin inline-block w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full mr-2"></span>
        ç™»éŒ²æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
      </p>
      <div id="profile-details" class="hidden">
        <!-- ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™»éŒ²æƒ…å ±ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                
        <!-- æ°åä¸¦åˆ—è¡¨ç¤º -->
        <div class="flex flex-wrap gap-x-4 mb-3">
          <div class="flex-1 min-w-0">
            <label class="block text-sm font-medium text-gray-600">æ°:</label>
            <p id="æ°" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
          </div>
          <div class="flex-1 min-w-0">
            <label class="block text-sm font-medium text-gray-600">å:</label>
            <p id="å" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
          </div>
        </div>

        <div class="flex flex-wrap gap-x-4 mb-3">
          <div class="flex-1 min-w-0">
            <label class="block text-sm font-medium text-gray-600">æ°ï¼ˆã²ã‚‰ãŒãªï¼‰:</label>
            <p id="æ°ï¼ˆã²ã‚‰ãŒãªï¼‰" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
          </div>
          <div class="flex-1 min-w-0">
            <label class="block text-sm font-medium text-gray-600">åï¼ˆã²ã‚‰ãŒãªï¼‰:</label>
            <p id="åï¼ˆã²ã‚‰ãŒãªï¼‰" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
          </div>
        </div>

        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">æ€§åˆ¥:</label>
          <p id="æ€§åˆ¥" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">ç”Ÿå¹´æœˆæ—¥:</label>
          <p id="ç”Ÿå¹´æœˆæ—¥" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
          <p id="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">æ‰€å±ãƒ»ç¤¾å:</label>
          <p id="æ‰€å±ãƒ»ç¤¾å" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">å½¹è·:</label>
          <p id="å½¹è·" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">é™å²¡å¸‚ã¨ã®ã¤ãªãŒã‚Š:</label>
          <p id="é™å²¡å¸‚ã¨ã®ã¤ãªãŒã‚Š" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-600">èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡:</label>
          <p id="èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡" class="text-lg font-semibold text-gray-900">æœªç™»éŒ²</p>
        </div>
      </div>
      <p id="error-message" class="text-red-500 text-center hidden">æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="flex flex-col space-y-4">
      <button onclick="location.href='edit-profile.html'"
              class="action-button w-full px-6 py-3 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 text-lg font-medium">
        ç™»éŒ²æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹
      </button>
      <button onclick="history.back()"
              class="action-button w-full px-6 py-3 bg-gray-300 text-gray-800 rounded-lg shadow-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 text-lg font-medium">
        æˆ»ã‚‹
      </button>
    </div>
  </div>

  <!-- LIFF SDKã‚’èª­ã¿è¾¼ã‚€ -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <script type="module">
    // --- Configuration ---
    // ã“ã“ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸGASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby7ng-4rZ3rNOVoQ5VzcKuNk28huMEvMVa7XUUYsCF2AXOxwnvZt7z-PXNeXQJ_Lvc2/exec';
    const LIFF_ID = "2007626441-bRzd722l"; // ã‚ãªãŸã® LIFF ID
    // --- End Configuration ---

    // UIè¦ç´ ã®å–å¾—
    const loadingMessage = document.getElementById('loading-message');
    const profileDetails = document.getElementById('profile-details');
    const errorMessage = document.getElementById('error-message');
    const displayNameEl = document.getElementById('display-name');
    const lineUserIdEl = document.getElementById('line-user-id'); // LINEãƒ¦ãƒ¼ã‚¶ãƒ¼IDè¡¨ç¤ºç”¨

    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼åã«å¯¾å¿œã™ã‚‹è¦ç´ IDã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
    const fieldElements = {
      "æ°": document.getElementById('æ°'),
      "å": document.getElementById('å'),
      "æ°ï¼ˆã²ã‚‰ãŒãªï¼‰": document.getElementById('æ°ï¼ˆã²ã‚‰ãŒãªï¼‰'),
      "åï¼ˆã²ã‚‰ãŒãªï¼‰": document.getElementById('åï¼ˆã²ã‚‰ãŒãªï¼‰'),
      "æ€§åˆ¥": document.getElementById('æ€§åˆ¥'),
      "ç”Ÿå¹´æœˆæ—¥": document.getElementById('ç”Ÿå¹´æœˆæ—¥'),
      "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹": document.getElementById('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'),
      "æ‰€å±ãƒ»ç¤¾å": document.getElementById('æ‰€å±ãƒ»ç¤¾å'),
      "å½¹è·": document.getElementById('å½¹è·'),
      "é™å²¡å¸‚ã¨ã®ã¤ãªãŒã‚Š": document.getElementById('é™å²¡å¸‚ã¨ã®ã¤ãªãŒã‚Š'),
      "èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡": document.getElementById('èˆˆå‘³ã®ã‚ã‚‹åˆ†é‡'),
      "é™å²¡å¸‚ã‚’å¿œæ´ã™ã‚‹æ°—æŒã¡ãŒå°‘ã—ã§ã‚‚ã‚ã‚Šã¾ã™ã‹ï¼Ÿ": document.getElementById('é™å²¡å¸‚ã‚’å¿œæ´ã™ã‚‹æ°—æŒã¡ãŒå°‘ã—ã§ã‚‚ã‚ã‚Šã¾ã™ã‹ï¼Ÿ')
    };

    let currentLineUserId = null; // LIFFã‹ã‚‰å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ä¿æŒ

    // LIFFã®åˆæœŸåŒ–ã¨LINEãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—
    async function initializeLiffAndFetchProfile() {
      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) {
          liff.login(); // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
          return;
        }

        const profile = await liff.getProfile();
        currentLineUserId = profile.userId; // LINEãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
        console.log("LIFF Profile:", profile);

        // LINEã®è¡¨ç¤ºåã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¡¨ç¤º
        if (displayNameEl) {
          displayNameEl.innerText = profile.displayName || 'ä¸æ˜';
        }
        if (lineUserIdEl) {
          lineUserIdEl.innerText = currentLineUserId || 'ä¸æ˜';
        }

        // LIFFèªè¨¼ã¨IDå–å¾—ãŒå®Œäº†ã—ãŸã‚‰ã€GASã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒ
        fetchUserProfileFromGAS(currentLineUserId);

      } catch (error) {
        console.error("LIFFã®åˆæœŸåŒ–ã¾ãŸã¯LINEæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
        displayErrorMessage("LINEæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        // LIFFã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã§ã‚‚ã€æœ€ä½é™ã®è¡¨ç¤ºã¯è©¦ã¿ã‚‹
        if (displayNameEl) displayNameEl.innerText = 'ä¸æ˜';
        if (lineUserIdEl) lineUserIdEl.innerText = 'ä¸æ˜';
        loadingMessage.classList.add('hidden');
      }
    }

    // GASã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
    async function fetchUserProfileFromGAS(userId) {
      if (!userId) {
        console.error("LINE User IDãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚");
        displayErrorMessage("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚LINEã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      // ã“ã“ã¯GAS_WEB_APP_URLãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã ã‘ã§ã€YOUR_GAS_WEB_APP_URL_HEREã§ã¯ãªã„ã“ã¨ã‚’ç¢ºèª
      if (!GAS_WEB_APP_URL || GAS_WEB_APP_URL.includes('YOUR_GAS_WEB_APP_URL_HERE')) {
        console.error("GAS_WEB_APP_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
        displayErrorMessage("GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }

      loadingMessage.classList.remove('hidden');
      profileDetails.classList.add('hidden');
      errorMessage.classList.add('hidden');

      try {
        // GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€userIdã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã™
        const response = await fetch(`${GAS_WEB_APP_URL}?userId=${userId}`);
        // 404 Not Foundã®å ´åˆã‚‚responseã¯è¿”ã£ã¦ãã‚‹ãŒã€okãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒfalseã«ãªã‚‹
        if (!response.ok) {
          console.error(`GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‹ã‚‰ã®å¿œç­”ã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`);
          displayErrorMessage(`ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ${response.status} (${response.statusText})`);
          return;
        }

        const result = await response.json();

        if (result.success && result.data) {
          const userData = result.data;
          console.log("User Data from GAS:", userData);

          // ãƒ‡ãƒ¼ã‚¿ã‚’HTMLè¦ç´ ã«è¡¨ç¤º
          for (const key in fieldElements) {
            if (fieldElements[key]) {
              // ç”Ÿå¹´æœˆæ—¥ã®ç‰¹åˆ¥å‡¦ç†
              if (key === "ç”Ÿå¹´æœˆæ—¥" && userData[key]) {
                const dateValue = new Date(userData[key]);
                // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœ‰åŠ¹ãªæ—¥ä»˜ã‚’è¡¨ã—ã¦ã„ã‚‹ã‹ç¢ºèª
                if (!isNaN(dateValue)) {
                  fieldElements[key].innerText = dateValue.toLocaleDateString('ja-JP', { year: 'numeric', month: 'numeric', day: 'numeric' });
                } else {
                  fieldElements[key].innerText = userData[key] + ' (ä¸æ­£ãªæ—¥ä»˜å½¢å¼)'; // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                }
              } else {
                fieldElements[key].innerText = userData[key] || 'æœªç™»éŒ²';
              }
            }
          }
          profileDetails.classList.remove('hidden');
        } else {
          console.log("GASã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:", result.message);
          displayErrorMessage(result.message || "ç™»éŒ²æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
          // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¾ãŸã¯ã€Œæœªç™»éŒ²ã€ã‚’è¡¨ç¤º
          for (const key in fieldElements) {
            if (fieldElements[key]) {
              fieldElements[key].innerText = 'æœªç™»éŒ²';
            }
          }
          profileDetails.classList.remove('hidden'); // ã‚¨ãƒ©ãƒ¼ã§ã‚‚è¡¨ç¤ºã‚¨ãƒªã‚¢ã¯å‡ºã™
        }
      } catch (error) {
        console.error("GASã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
        displayErrorMessage("ç™»éŒ²æƒ…å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      } finally {
        loadingMessage.classList.add('hidden'); // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤ºã«ã™ã‚‹
      }
    }

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function displayErrorMessage(message) {
      errorMessage.innerText = message;
      errorMessage.classList.remove('hidden');
      loadingMessage.classList.add('hidden');
      profileDetails.classList.add('hidden');
    }

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹å§‹
    initializeLiffAndFetchProfile();
  </script>
</body>
</html>
